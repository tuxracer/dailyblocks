# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

dailyblocks is a Reddit video player built with React 19, TypeScript, and Vite. It fetches videos from subreddits via Reddit's public JSON API and plays them using react-player.

## Commands

```bash
npm run dev      # Start development server (http://localhost:5173)
npm run build    # Type check (tsc -b) then Vite production build
npm run lint     # Run ESLint
npm run preview  # Preview production build
```

## Architecture

### Tech Stack
- **React 19** with React Compiler (auto-memoization via babel-plugin-react-compiler)
- **TanStack Router** with file-based routing (routes auto-generated in `src/routeTree.gen.ts`)
- **SWR** for data fetching and caching
- **Tailwind CSS v4** via @tailwindcss/vite plugin
- **react-player** for video playback (YouTube, Vimeo, Reddit native video)

### Source Structure
```
src/
├── routes/          # File-based routing (TanStack Router)
├── components/      # React components (Comments, Thumbnails)
├── hooks/           # SWR-based data fetching hooks
├── models/          # Data classes (RedditPost, RedditComment)
├── contexts/        # React Context (WatchedVideosHistoryContext)
├── utils/           # Reddit API utilities
└── main.tsx         # App entry point
```

### Routing
File names map to URL paths using TanStack Router conventions:
- `$` prefix = URL parameter (e.g., `r.$subreddit.index.tsx` → `/r/{subreddit}`)
- `$` suffix = catch-all segment
- Route tree is auto-generated by @tanstack/router-plugin

Key routes:
- `/` → Redirects to first unwatched video in r/videos
- `/r/{subreddit}` → Redirects to first video in subreddit
- `/r/{subreddit}/comments/{postId}/*` → Video player page

### Data Flow
1. Custom hooks (`useSubreddit`, `useRedditPost`, `useRedditComments`) fetch from Reddit API
2. `RedditPost` and `RedditComment` classes parse API responses
3. `WatchedVideosHistoryContext` tracks watched videos in localStorage
4. SWR handles caching (configured with `revalidateOnFocus: false`, `revalidateIfStale: false`)

### Reddit API
- Direct calls to Reddit's public JSON API (no authentication)
- Utility functions in `src/utils/reddit.ts`
- Uses `raw_json=1` param to get unescaped HTML
- Filters posts by playable media using `ReactPlayer.canPlay()`
